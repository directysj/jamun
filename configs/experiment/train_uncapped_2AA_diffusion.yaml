# @package _global_

defaults:
  - override /callbacks:
    - visualize_denoise.yaml
    - timing.yaml
    - ema.yaml
    - ema_model_checkpoint.yaml
  - _self_

compute_average_squared_distance_from_data: true

model:
  sigma_distribution:
    _target_: jamun.distributions.ClippedLogNormalSigma
    log_sigma_mean: -3.2188758248682006 # log(0.04)
    log_sigma_std: 1.0
  max_radius: 1.0
  optim:
    lr: 2e-3
  arch:
    irreps_hidden: "120x0e + 32x1e"
    hidden_layer_factory:
      _target_: "e3tools.nn.SeparableConvBlock"


callbacks:
  viz:
    sigma_list: [0.04]

data:
  datamodule:
    batch_size: 32
    datasets:
      train:
        _target_: jamun.data.parse_datasets_from_directory
        root: "${paths.data_path}/timewarp/2AA-1-large/train/"
        traj_pattern: "^(.*)-traj-arrays.npz"
        pdb_pattern: "^(.*)-traj-state0.pdb"
        num_workers: 16

      val:
        _target_: jamun.data.parse_datasets_from_directory
        root: "${paths.data_path}/timewarp/2AA-1-large/val/"
        traj_pattern: "^(.*)-traj-arrays.npz"
        pdb_pattern: "^(.*)-traj-state0.pdb"
        subsample: 100
        max_datasets: 20
        num_workers: 16

      test:
        _target_: jamun.data.parse_datasets_from_directory
        root: "${paths.data_path}/timewarp/2AA-1-large/test/"
        traj_pattern: "^(.*)-traj-arrays.npz"
        pdb_pattern: "^(.*)-traj-state0.pdb"
        subsample: 100
        max_datasets: 20
        num_workers: 16

trainer:
  val_check_interval: 50000
  check_val_every_n_epoch: null
  max_epochs: 10
  num_sanity_val_steps: 0

logger:
  wandb:
    group: train_uncapped_2AA
